<!-- 
Contributors: Raghurama Bukkarayasamudram, Ritam Das, Brian Macomber
Date: 10/8/2020
Quest 2 - Tactile Internet
 -->
<!DOCTYPE html>
<html>
  <head>
    <style type="text/css">
      input[type="radio"] {
        margin: 20px 20px 20px 20px 20px 20px 20px 20px 20px 20px;
      };
    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script
      type="text/javascript"
      src="https://canvasjs.com/assets/script/canvasjs.min.js"
    ></script>
    <script type="text/javascript">
      //function that is called every time the page is reloaded
      window.onload = function () {
        function updateChart() {
          // this function reads the current csv data and plots it using CanvasJS
          var dataPoints_1 = [],
            dataPoints_2 = [],
            dataPoints_3 = [];
          //Query all the data at the localhost:8080/data endpoint
          $.ajax({
            url: "/data",
            success: function (result) {
              var count = 1;
              jQuery.each(result, function (i, val) {
                //grabbing csv data for
                dataPoints_1.push({
                  x: count,
                  y: parseFloat(val[0]),
                });
                dataPoints_2.push({
                  x: count,
                  y: parseFloat(val[1]),
                });
                dataPoints_3.push({
                  x: count,
                  y: parseFloat(val[2]),
                });

                count += 1;
              });

              // here I can take only the data points up to a certain amount
              var maxDataPoints = 30, //30 second sliding window
                dataPoints_1_trimmed = [],
                dataPoints_2_trimmed = [],
                dataPoints_3_trimmed = [];

              if (dataPoints_1.length > maxDataPoints) {
                for (
                  let i = dataPoints_1.length - maxDataPoints;
                  i < dataPoints_1.length;
                  i++
                ) {
                  dataPoints_1_trimmed.push(dataPoints_1[i]);
                  dataPoints_2_trimmed.push(dataPoints_2[i]);
                  dataPoints_3_trimmed.push(dataPoints_3[i]);
                }
              } else {
                for (let i = 0; i < dataPoints_1.length; i++) {
                  dataPoints_1_trimmed.push(dataPoints_1[i]);
                  dataPoints_2_trimmed.push(dataPoints_2[i]);
                  dataPoints_3_trimmed.push(dataPoints_3[i]);
                }
              }

              // chart that is being plotted
              var chart1 = new CanvasJS.Chart("chartContainer1", {
                title: {
                  text: "Plotting Roll vs. Time",
                },
                axisY: [
                  {
                    title: "Roll",
                    suffix: String.fromCharCode(176),
                  },
                ],
                axisX: {
                  title: "t (in seconds)",
                  suffix: "s",
                },
                toolTip: {
                  shared: true,
                },
                legend: {
                  cursor: "pointer",
                  verticalAlign: "top",
                  horizontalAlign: "center",
                  dockInsidePlotArea: true,
                  itemclick: toogleDataSeries,
                },
                data: [
                  {
                    type: "line",
                    axisYIndex: 0,
                    name: "Roll",
                    showInLegend: true,
                    dataPoints: dataPoints_1_trimmed,
                    markerType: "circle",
                  },
                ],
              });
              // pitch vs time
              var chart2 = new CanvasJS.Chart("chartContainer2", {
                title: {
                  text: "Plotting Pitch vs. Time",
                },
                axisY: [
                  {
                    title: "Pitch",
                    suffix: String.fromCharCode(176),
                  },
                ],
                axisX: {
                  title: "t (in seconds)",
                  suffix: "s",
                },
                toolTip: {
                  shared: true,
                },
                legend: {
                  cursor: "pointer",
                  verticalAlign: "top",
                  horizontalAlign: "center",
                  dockInsidePlotArea: true,
                  itemclick: toogleDataSeries,
                },
                data: [
                  {
                    type: "line",
                    axisYIndex: 0,
                    name: "Pitch",
                    showInLegend: true,
                    dataPoints: dataPoints_2_trimmed,
                    markerType: "circle",
                  },
                ],
              });
              // temperature vs time
              var chart3 = new CanvasJS.Chart("chartContainer3", {
                title: {
                  text: "Plotting Temperature vs. Time",
                },
                axisY: [
                  {
                    title: "Temperature",
                    suffix: String.fromCharCode(176) + "C",
                  },
                ],
                axisX: {
                  title: "t (in seconds)",
                  suffix: "s",
                },
                toolTip: {
                  shared: true,
                },
                legend: {
                  cursor: "pointer",
                  verticalAlign: "top",
                  horizontalAlign: "center",
                  dockInsidePlotArea: true,
                  itemclick: toogleDataSeries,
                },
                data: [
                  {
                    type: "line",
                    axisYIndex: 0,
                    name: "Temperature",
                    showInLegend: true,
                    dataPoints: dataPoints_3_trimmed,
                    markerType: "circle",
                  },
                ],
              });
              // allows user to hover over data points to see values
              function toogleDataSeries(e) {
                if (
                  typeof e.dataSeries.visible === "undefined" ||
                  e.dataSeries.visible
                ) {
                  e.dataSeries.visible = false;
                } else {
                  e.dataSeries.visible = true;
                }
                chart1.render();
                chart2.render();
                chart3.render();
              }
              chart1.render();
              chart2.render();
              chart3.render();
            },
          });
        }
        //initial call to fcn to read and plot
        updateChart();
        // auto update graph every 3 seconds
        setInterval(function () {
          updateChart();
        }, 3000);
      };

      var radios = document.getElementsByName('editList');

        for (var i = 0, length = radios.length; i < length; i++) {
          if (radios[i].checked) {
            // do whatever you want with the checked radio
            
            alert(radios[i].value);

            // only one radio can be logically checked, don't check the rest
            break;
          }
        }
    </script>
    
  </head>
  
  <body>
    <div id="chartContainer1" style="width: 100%; height: 300px"></div>
    <div id="chartContainer2" style="width: 100%; height: 300px"></div>
    <div id="chartContainer3" style="width: 100%; height: 300px"></div>
  </body>

    <input type="radio" name="editList" value="0">0
    <input type="radio" name="editList" value="1">1
    <input type="radio" name="editList" value="2">2
    <input type="radio" name="editList" value="2">3
    <input type="radio" name="editList" value="2">4
    <input type="radio" name="editList" value="2">5
    <input type="radio" name="editList" value="2">6
    <input type="radio" name="editList" value="2">7
    <input type="radio" name="editList" value="2">8
    <input type="radio" name="editList" value="2">9

    
</html>
